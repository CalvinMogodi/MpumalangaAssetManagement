<p-toast [style]="{marginTop: '80px'}" position="top-right"></p-toast>
<p-tabView [(activeIndex)]="activeIndex">
    <p-tabPanel header="Land">
        <form [formGroup]="landForm" *ngIf="!loading" (ngSubmit)="onLandFormSubmit()">
            <div class="ui-g ui-fluid" style="overflow-y: auto; overflow-x: hidden; height: 500px;width: 100%">
                <div class="ui-g-12 ui-md-12" *ngIf="mode != 'View'">
                    <p-fileUpload [showUploadButton]="false" [showCancelButton]="false" (onRemove)="onLandRemoveFile($event)" multiple="multiple" (onSelect)="onLandSelectFile($event.files)" ></p-fileUpload>
                    <div>
                        <ul *ngFor="let file of landFiles; let i = index" style="list-style-type:none;">
                            <li>
                                <p><a target="_blank" href="{{ file.url }}">{{ file.name }}</a></p>
                            </li>
                        </ul>                        
                    </div>   
                </div>
                <p-fieldset legend="General" [toggleable]="true" >
                    <div class="ui-g-12 ui-md-12">
                        <div class="ui-g-4 ui-md-4">
                            <label for="fileReferenceNumber">File Reference Number</label>
                            <input  [(ngModel)]="facility.fileReference" [ngModelOptions]="{standalone: true}" disabled="true" autocomplete="off" type="text" pInputText
                               class="ui-inputtext ui-widget"> 
                        </div>
                        <div class="ui-g-4 ui-md-4">
                            <label for="clientCode">Property Code</label>
                            <input formControlName="clientCode" autocomplete="off" type="text" pInputText
                               class="ui-inputtext ui-widget">
                            <div *ngIf="submitted && f.clientCode.errors"
                                class="text-error"><br>
                                <div *ngIf="l.propertyCode.errors.required">This field is required.</div>
                            </div>                          
                        </div>
                        <div class="ui-g-4 ui-md-4">
                            <label for="deedsOffice">Deeds Office</label>
                            <p-dropdown [disabled]="mode == 'View'" inputId="deedsOffice" [options]="deedsOffices"
                            placeholder="Please select" formControlName="deedsOffice" (onChange)="setDeedsOffice($event)" optionLabel="name"></p-dropdown>
                            <div *ngIf="submitted && f.deedsOffices.errors" class="text-error"><br>
                                <div *ngIf="l.deedsOffices.errors.required">This field is required.</div>
                            </div>
                        </div>
                    </div>
                    <div class="ui-g-12 ui-md-12">                       
                        <div class="ui-g-4 ui-md-4">
                            <label for="class">Asset Class</label>
                            <p-dropdown inputId="class" [disabled]="mode == 'View'" [options]="classes"
                            placeholder="Please select" formControlName="class" (onChange)="setClass($event)" optionLabel="name">
                            </p-dropdown>
                            <div *ngIf="submitted && f.class.errors" class="text-error"><br>
                                <div *ngIf="l.class.errors.required">This field is required.</div>
                            </div>
                        </div>
                        <div class="ui-g-4 ui-md-4">
                            <label for="type">Asset Type</label>
                            <p-dropdown inputId="type" [disabled]="mode == 'View'" [options]="types"
                            placeholder="Please select" (onChange)="setType($event)" formControlName="type" optionLabel="name"></p-dropdown>
                            <div *ngIf="submitted && f.fileReferenceNumber.errors"
                                class="text-error"><br>
                                <div *ngIf="l.fileReferenceNumber.errors.required">This field is required.</div>
                            </div>
                        </div>
                        <div class="ui-g-4 ui-md-4">
                            <label for="survey">Survey</label>
                            <p-dropdown inputId="survey" [disabled]="mode == 'View'" [options]="surveys"
                              placeholder="Please select" formControlName="survey" optionLabel="name">
                            </p-dropdown>
                            <div *ngIf="submitted && f.survey.errors" class="text-error"><br>
                                <div *ngIf="l.survey.errors.required">This field is required.</div>
                            </div>
                        </div>
                    </div>
                    <div class="ui-g-12 ui-md-12">                       
                        <div class="ui-g-4 ui-md-4">
                            <label for="vestedType">Vested Type</label>
                            <p-dropdown inputId="vestedType" [disabled]="mode == 'View'" [options]="vestedTypes"
                            placeholder="Please select" formControlName="vestedType" optionLabel="name">
                            </p-dropdown>
                            <div *ngIf="submitted && f.vestedType.errors" class="text-error"><br>
                                <div *ngIf="l.vestedType.errors.required">This field is required.</div>
                            </div>
                        </div>
                        <div class="ui-g-4 ui-md-4">
                            <label for="afs">AFS</label>
                            <p-dropdown inputId="afs" [disabled]="mode == 'View'" [options]="aFSs"
                            placeholder="Please select" formControlName="afs" optionLabel="name">
                            </p-dropdown>
                            <div *ngIf="submitted && f.afs.errors" class="text-error"><br>
                                <div *ngIf="l.afs.errors.required">This field is required.</div>
                            </div>
                        </div>
                        <div class="ui-g-4 ui-md-4">
                           
                        </div>
                    </div>
                </p-fieldset>
                <p-fieldset legend="Geographical Location" [toggleable]="true">
                    <div class="ui-g-12 ui-md-12">
                        <div class="ui-g-4 ui-md-4">
                            <label for="province">Province</label>
                            <p-dropdown inputId="province" [(ngModel)]="province" [options]="provinces"
                            formControlName="province" (onChange)="setProvince($event)" optionLabel="name">
                            </p-dropdown>
                            <div *ngIf="submitted && f.fileReferenceNumber.errors"
                                class="text-error"><br>
                                <div *ngIf="l.fileReferenceNumber.errors.required">This field is required.</div>
                            </div>
                        </div>
                        <div class="ui-g-4 ui-md-4">
                            <label for="districtMunicipality">District Municipality</label>
                            <p-dropdown inputId="districtMunicipality" [options]="districtMunicipalities"
                            placeholder="Please select" formControlName="districtMunicipality" (onChange)="setDistrictMunicipality($event)"
                                optionLabel="name"></p-dropdown>
                            <div *ngIf="submitted && f.fileReferenceNumber.errors"
                                class="text-error"><br>
                                <div *ngIf="l.fileReferenceNumber.errors.required">This field is required.</div>
                            </div>
                        </div>
                        <div class="ui-g-4 ui-md-4">
                            <label for="region">Region</label>
                            <p-dropdown inputId="region" [options]="regions" formControlName="region"
                            placeholder="Please select" (onChange)="setProvince($event)" optionLabel="name">
                            </p-dropdown>
                            <div *ngIf="submitted && f.fileReferenceNumber.errors"
                                class="text-error"><br>
                                <div *ngIf="l.fileReferenceNumber.errors.required">This field is required.</div>
                            </div>
                        </div>
                    </div>
                    <div class="ui-g-12 ui-md-12">
                        <div class="ui-g-4 ui-md-4">
                            <label for="localAuthority">Local Authority</label>
                            <p-dropdown inputId="localAuthority" [options]="localAuthorities"
                            placeholder="Please select" formControlName="localAuthority" (onChange)="setLocalAuthorities($event)"
                                optionLabel="name"></p-dropdown>
                            <div *ngIf="submitted && f.fileReferenceNumber.errors"
                                class="text-error"><br>
                                <div *ngIf="l.fileReferenceNumber.errors.required">This field is required.</div>
                            </div>
                        </div>
                        <div class="ui-g-4 ui-md-4">
                            <label for="magisterialDistrict">Magisterial District</label>
                            <p-dropdown inputId="magisterialDistrict" [options]="magisterialDistricts"
                            placeholder="Please select" formControlName="magisterialDistrict" (onChange)="setMagisterialDistrict($event)"
                                optionLabel="name"></p-dropdown>
                            <div *ngIf="submitted && f.fileReferenceNumber.errors"
                                class="text-error"><br>
                                <div *ngIf="l.fileReferenceNumber.errors.required">This field is required.</div>
                            </div>
                        </div>
                        <div class="ui-g-4 ui-md-4">
                            <label for="streetNumber">Street Number</label>
                            <input formControlName="streetNumber" autocomplete="off" type="number" pInputText
                               class="ui-inputtext ui-widget">
                            <div *ngIf="submitted && f.fileReferenceNumber.errors"
                                class="text-error"><br>
                                <div *ngIf="l.fileReferenceNumber.errors.required">This field is required.</div>
                            </div>
                        </div>
                    </div>
                    <div class="ui-g-12 ui-md-12">
                        <div class="ui-g-4 ui-md-4">
                            <label for="streetName">Street Name </label>
                            <input formControlName="streetName" autocomplete="off" type="text" pInputText
                                class="ui-inputtext ui-widget">
                            <div *ngIf="submitted && f.fileReferenceNumber.errors"
                                class="text-error"><br>
                                <div *ngIf="l.fileReferenceNumber.errors.required">This field is required.</div>
                            </div>
                        </div>
                        <div class="ui-g-4 ui-md-4">
                            <label for="suburb">Suburb</label>
                            <input formControlName="suburb" autocomplete="off" type="text" pInputText
                               class="ui-inputtext ui-widget">
                            <div *ngIf="submitted && f.fileReferenceNumber.errors"
                                class="text-error"><br>
                                <div *ngIf="l.fileReferenceNumber.errors.required">This field is required.</div>
                            </div>
                        </div>
                        <div class="ui-g-4 ui-md-4">
                            <label for="town">Town</label>
                            <input formControlName="town" autocomplete="off" type="text" pInputText
                                class="ui-inputtext ui-widget">
                            <div *ngIf="submitted && f.fileReferenceNumber.errors"
                                class="text-error"><br>
                                <div *ngIf="l.fileReferenceNumber.errors.required">This field is required.</div>
                            </div>
                        </div>
                    </div>
                    <div class="ui-g-12 ui-md-12">
                        <div class="ui-g-4 ui-md-4">
                            <label for="longitude">GPS Coordinates Longitude</label>
                            <input formControlName="longitude" ng-pattern="/^[-+]?[0-9]{1,7}(\.[0-9]+)?$/"
                                autocomplete="off" type="text" pInputText class="ui-inputtext ui-widget">
                            <div *ngIf="submitted && f.fileReferenceNumber.errors"
                                class="text-error"><br>
                                <div *ngIf="l.fileReferenceNumber.errors.required">This field is required.</div>
                            </div>
                        </div>
                        <div class="ui-g-4 ui-md-4">
                            <label for="latitude">GPS Coordinates Latitude</label>
                            <input formControlName="latitude" autocomplete="off"
                                ng-pattern="/^[-+]?[0-9]{1,7}(\.[0-9]+)?$/" type="text" pInputText class="ui-inputtext ui-widget">
                            <div *ngIf="submitted && f.fileReferenceNumber.errors"
                                class="text-error"><br>
                                <div *ngIf="l.fileReferenceNumber.errors.required">This field is required.</div>
                            </div>
                        </div>
                    </div>
                </p-fieldset>
                <p-fieldset legend="Property Description" [toggleable]="true">
                    <div class="ui-g-12 ui-md-12">
                        <div class="ui-g-4 ui-md-4">
                            <label for="registrationDivision">Registration Division</label>
                            <p-dropdown inputId="registrationDivision" [options]="registrationDivisions"
                            placeholder="Please select" [(ngModel)]="registrationDivision" formControlName="registrationDivision"
                                optionLabel="name"></p-dropdown>
                            <div *ngIf="submitted && f.registrationDivision.errors"
                                class="text-error"><br>
                                <div *ngIf="l.registrationDivision.errors.required">This field is required.</div>
                            </div>
                        </div>
                        <div class="ui-g-4 ui-md-4">
                            <label for="townshipName">Township Name</label>
                            <input formControlName="townshipName" autocomplete="off" type="text" pInputText
                                class="ui-inputtext ui-widget">
                            <div *ngIf="submitted && f.townshipName.errors" class="text-error"><br>
                                <div *ngIf="l.townshipName.errors.required">This field is required.</div>
                            </div>
                        </div>
                        <div class="ui-g-4 ui-md-4">
                            <label for="landParcel">Land Parcel</label>
                            <input formControlName="landParcel" autocomplete="off" type="text" pInputText
                                class="ui-inputtext ui-widget">
                            <div *ngIf="submitted && f.fileReferenceNumber.errors"
                                class="text-error"><br>
                                <div *ngIf="l.fileReferenceNumber.errors.required">This field is required.</div>
                            </div>
                        </div>
                    </div>
                    <div class="ui-g-12 ui-md-12">
                        <div class="ui-g-4 ui-md-4">
                            <label for="landPortion">Land Portion</label>
                            <input formControlName="landPortion" autocomplete="off" type="text" pInputText
                                class="ui-inputtext ui-widget">
                            <div *ngIf="submitted && f.fileReferenceNumber.errors"
                                class="text-error"><br>
                                <div *ngIf="l.fileReferenceNumber.errors.required">This field is required.</div>
                            </div>
                        </div>
                        <div class="ui-g-4 ui-md-4">
                            <label for="oldDescription">Old Description</label>
                            <input formControlName="oldDescription" autocomplete="off" type="text" pInputText
                                class="ui-inputtext ui-widget">
                            <div *ngIf="submitted && f.fileReferenceNumber.errors"
                                class="text-error"><br>
                                <div *ngIf="l.fileReferenceNumber.errors.required">This field is required.</div>
                            </div>
                        </div>
                        <div class="ui-g-4 ui-md-4">
                            <label for="landRemainder">Land Remainder</label>
                            <p-dropdown inputId="landRemainder" [options]="landRemainders"
                                formControlName="landRemainder" (onChange)="setProvince($event)" optionLabel="name"
                                placeholder="Please select"></p-dropdown>
                            <div *ngIf="submitted && f.fileReferenceNumber.errors"
                                class="text-error"><br>
                                <div *ngIf="l.fileReferenceNumber.errors.required">This field is required.</div>
                            </div>
                        </div>
                    </div>
                    <div class="ui-g-12 ui-md-12">
                        <div class="ui-g-4 ui-md-4">
                            <label for="farmName">Farm Name</label>
                            <input formControlName="farmName" autocomplete="off" type="text" pInputText
                                class="ui-inputtext ui-widget">
                            <div *ngIf="submitted && f.fileReferenceNumber.errors"
                                class="text-error"><br>
                                <div *ngIf="l.fileReferenceNumber.errors.required">This field is required.</div>
                            </div>
                        </div>
                        <div class="ui-g-4 ui-md-4">
                            <label for="SGDiagramNumber">SG Diagram Number</label>
                            <input formControlName="SGDiagramNumber" autocomplete="off" type="text" pInputText
                                class="ui-inputtext ui-widget">
                            <div *ngIf="submitted && f.fileReferenceNumber.errors"
                                class="text-error"><br>
                                <div *ngIf="l.fileReferenceNumber.errors.required">This field is required.</div>
                            </div>
                        </div>
                        <div class="ui-g-4 ui-md-4">
                            <label for="extent">Extent (Size of Land) (HA)</label>
                            <input formControlName="extent" autocomplete="off" type="number" pInputText
                                class="ui-inputtext ui-widget">
                            <div *ngIf="submitted && f.fileReferenceNumber.errors"
                                class="text-error"><br>
                                <div *ngIf="l.fileReferenceNumber.errors.required">This field is required.</div>
                            </div>
                        </div>
                    </div>
                    <div class="ui-g-12 ui-md-12">
                        <div class="ui-g-4 ui-md-4">
                            <label for="LPICode">LPI Code </label>
                            <input formControlName="LPICode" autocomplete="off" type="text" pInputText
                                class="ui-inputtext ui-widget">
                            <div *ngIf="submitted && f.fileReferenceNumber.errors"
                                class="text-error"><br>
                                <div *ngIf="l.fileReferenceNumber.errors.required">This field is required.</div>
                            </div>
                        </div>
                        <div class="ui-g-4 ui-md-4">
                            <label for="howAcquired">How Acquired</label>
                            <p-dropdown inputId="howAcquired" [options]="howAcquireds" [(ngModel)]="howAcquired"
                                formControlName="acquired" (onChange)="setHowAcquired($event)" optionLabel="name"
                                placeholder="Please select"></p-dropdown>
                            <div *ngIf="submitted && f.fileReferenceNumber.errors"
                                class="text-error"><br>
                                <div *ngIf="l.fileReferenceNumber.errors.required">This field is required.</div>
                            </div>
                        </div>
                        <div class="ui-g-4 ui-md-4" *ngIf="howAcquired.name === 'Other'">
                            <label for="acquiredOther">How acquired: other</label>
                            <input formControlName="acquiredOther" autocomplete="off" type="text" pInputText
                                class="ui-inputtext ui-widget">
                            <div *ngIf="submitted && f.howAcquired.errors" class="text-error"><br>
                                <div *ngIf="l.howAcquired.errors.required">This field is required.</div>
                            </div>
                        </div>
                    </div>
                </p-fieldset>

                <p-fieldset legend="Land Use & Management Details" [toggleable]="true">
                    <div class="ui-g-12 ui-md-12">
                        <div class="ui-g-4 ui-md-4">
                            <label for="titleDeedNumber">Title Deed Number</label>
                            <input formControlName="titleDeedNumber" autocomplete="off" type="text" pInputText
                               class="ui-inputtext ui-widget">
                            <div *ngIf="submitted && f.titleDeedNumber.errors" class="text-error">
                                <br>
                                <div *ngIf="l.titleDeedNumber.errors.required">This field is required.</div>
                            </div>
                        </div>
                        <div class="ui-g-4 ui-md-4">
                            <label for="class">Registration Date</label>
                            <p-calendar [maxDate]="today" formControlName="registrationDate" dateFormat="dd/mm/yy" showOtherMonths="true"
                                showButtonBar="true"></p-calendar>
                            <div *ngIf="submitted&& f.fileReferenceNumber.errors"
                                class="text-error"><br>
                                <div *ngIf="l.fileReferenceNumber.errors.required">This field is required.</div>
                            </div>
                        </div>
                        <div class="ui-g-4 ui-md-4">
                            <label for="registeredOwner">Registered Owner</label>
                            <input formControlName="registeredOwner" autocomplete="off" type="text" pInputText
                                class="ui-inputtext ui-widget">
                            <div *ngIf="submitted && f.registeredOwner.errors" class="text-error">
                                <br>
                                <div *ngIf="l.registeredOwner.errors.required">This field is required.</div>
                            </div>
                        </div>
                    </div>

                    <div class="ui-g-12 ui-md-12">
                        <div class="ui-g-4 ui-md-4">
                            <label for="vestingDate">Vesting Date</label>
                            <p-calendar formControlName="vestingDate" dateFormat="dd/mm/yy" showOtherMonths="true"
                                showButtonBar="true"></p-calendar>
                            <div *ngIf="submitted && l.vestingDate.errors" class="text-error"><br>
                                <div *ngIf="l.vestingDate.errors.required">This field is required.</div>
                            </div>
                        </div>
                        <div class="ui-g-4 ui-md-4">
                            <label for="conditionsOfTitle">Conditions Of Title</label>
                            <input formControlName="conditionsOfTitle" autocomplete="off" type="text" pInputText
                                class="ui-inputtext ui-widget">
                            <div *ngIf="submitted && f.conditionsOfTitle.errors"
                                class="text-error"><br>
                                <div *ngIf="l.conditionsOfTitle.errors.required">This field is required.</div>
                            </div>
                        </div>
                        <div class="ui-g-4 ui-md-4">
                            <label for="type">Ownership Category</label>
                            <p-dropdown inputId="ownershipCategory" [options]="ownershipCategories"
                                formControlName="ownershipCategory" optionLabel="name"
                                placeholder="Please select"></p-dropdown>
                            <div *ngIf="submitted && f.ownershipCategory.errors"
                                class="text-error"><br>
                                <div *ngIf="l.ownershipCategory.errors.required">This field is required.</div>
                            </div>
                        </div>
                    </div>

                    <div class="ui-g-12 ui-md-12">
                        <div class="ui-g-4 ui-md-4">
                            <label for="stateOwnedPercentage">State Owned Percentage</label>
                            <input formControlName="stateOwnedPercentage" autocomplete="off" type="number" pInputText
                                class="ui-inputtext ui-widget">
                            <div *ngIf="submitted && f.stateOwnedPercentage.errors"
                                class="text-error"><br>
                                <div *ngIf="l.stateOwnedPercentage.errors.required">This field is required.</div>
                            </div>
                        </div>
                        <div class="ui-g-4 ui-md-4">
                            <label for="landUse">Land Use %</label>
                            <input formControlName="landUse" autocomplete="off" type="text" pInputText
                                class="ui-inputtext ui-widget">
                            <div *ngIf="submitted && f.landUse.errors" class="text-error"><br>
                                <div *ngIf="l.landUse.errors.required">This field is required.</div>
                            </div>
                        </div>
                        <div class="ui-g-4 ui-md-4">
                            <label for="zoning">Zoning</label>
                            <input formControlName="zoning" autocomplete="off" type="text" pInputText
                                class="ui-inputtext ui-widget">
                            <div *ngIf="submitted && f.zoning.errors" class="text-error"><br>
                                <div *ngIf="l.zoning.errors.required">This field is required.</div>
                            </div>
                        </div>
                    </div>
                    <div class="ui-g-12 ui-md-12">
                        <div class="ui-g-4 ui-md-4">
                            <label for="userDepartment">User Department</label>
                           <p-dropdown inputId="userDepartment" [options]="userDepartments"
                                formControlName="userDepartment" optionLabel="name"
                                placeholder="Please select"></p-dropdown>

                           <!-- <input formControlName="userDepartment" autocomplete="off" type="text" pInputText
                                class="ui-inputtext ui-widget">-->
                            <div *ngIf="submitted && f.userDepartment.errors" class="text-error">
                                <br>
                                <div *ngIf="l.userDepartment.errors.required">This field is required.</div>
                            </div>
                        </div>
                        <div class="ui-g-4 ui-md-4">
                            <label for="facilityName">Facility Name</label>
                            <input formControlName="facilityName" autocomplete="off" type="text" pInputText
                                class="ui-inputtext ui-widget">
                            <div *ngIf="submitted && f.facilityName.errors" class="text-error"><br>
                                <div *ngIf="l.facilityName.errors.required">This field is required.</div>
                            </div>
                        </div>
                        <div class="ui-g-4 ui-md-4">
                            <label for="incomeLeaseStatus">Income Lease Status</label>
                            <p-dropdown inputId="incomeLeaseStatus" [options]="incomeLeaseStatuses"
                                formControlName="incomeLeaseStatus" (onChange)="setProvince($event)" optionLabel="name"
                                placeholder="Please select"></p-dropdown>
                            <div *ngIf="submitted && f.incomeLeaseStatus.errors"
                                class="text-error"><br>
                                <div *ngIf="l.incomeLeaseStatus.errors.required">This field is required.</div>
                            </div>
                        </div>
                    </div>
                </p-fieldset>

                <p-fieldset legend="Lease Status" [toggleable]="true">
                    <div class="ui-g-12 ui-md-12">
                        <div class="ui-g-4 ui-md-4">
                            <label for="natureOfLease">Nature of Lease</label>
                            <p-dropdown inputId="natureOfLease" [options]="natureOfLeases"
                                formControlName="natureOfLease" (onChange)="setDeedsOffice($event)" optionLabel="name"
                                placeholder="Please select"></p-dropdown>
                            <div *ngIf="submitted && f.natureOfLease.errors" class="text-error">
                                <br>
                                <div *ngIf="l.natureOfLease.errors.required">This field is required.</div>
                            </div>
                        </div>
                        <div class="ui-g-4 ui-md-4">
                            <label for="IDNumberCompanyRegistrationNumber">ID Number/Company Registration
                                Number</label>
                            <input formControlName="IDNumberCompanyRegistrationNumber" autocomplete="off" type="text"
                                pInputText
                                class="ui-inputtext ui-widget">
                            <div *ngIf="submitted && f.IDNumberCompanyRegistrationNumber.errors"
                                class="text-error">
                                <br>
                                <div *ngIf="l.IDNumberCompanyRegistrationNumber.errors.required">This field is
                                    required.</div>
                            </div>
                        </div>
                        <div class="ui-g-4 ui-md-4">
                            <label for="POBox">P.O.Box</label>
                            <input formControlName="POBox" autocomplete="off" type="number" pInputText
                                class="ui-inputtext ui-widget">
                            <div *ngIf="submitted && f.POBox.errors" class="text-error"><br>
                                <div *ngIf="l.POBox.errors.required">This field is required.</div>
                            </div>
                        </div>
                    </div>
                    <div class="ui-g-12 ui-md-12">
                        <div class="ui-g-4 ui-md-4">
                            <label for="leaseStatusTown">Town</label>
                            <input formControlName="leaseStatusTown" autocomplete="off" type="text" pInputText
                                class="ui-inputtext ui-widget">
                            <div *ngIf="submitted && f.town.errors" class="text-error"><br>
                                <div *ngIf="l.town.errors.required">This field is required.</div>
                            </div>
                        </div>
                        <div class="ui-g-4 ui-md-4">
                            <label for="postalCode">Postal Code</label>
                            <input formControlName="postalCode" autocomplete="off" type="number" pInputText
                                class="ui-inputtext ui-widget">
                            <div *ngIf="submitted && f.postalCode.errors" class="text-error"><br>
                                <div *ngIf="l.postalCode.errors.required">This field is required.</div>
                            </div>
                        </div>
                        <div class="ui-g-4 ui-md-4">
                            <label for="contactPerson">Contact Person</label>
                            <input formControlName="contactPerson" autocomplete="off" type="text" pInputText
                                class="ui-inputtext ui-widget">
                            <div *ngIf="submitted && f.contactPerson.errors" class="text-error">
                                <br>
                                <div *ngIf="l.contactPerson.errors.required">This field is required.</div>
                            </div>
                        </div>
                    </div>
                    <div class="ui-g-12 ui-md-12">
                        <div class="ui-g-4 ui-md-4">
                            <label for="capacityofContactPerson">Capacity of Contact Person</label>
                            <input formControlName="capacityofContactPerson" autocomplete="off" type="text" pInputText
                                class="ui-inputtext ui-widget">
                            <div *ngIf="submitted && f.capacityofContactPerson.errors"
                                class="text-error"><br>
                                <div *ngIf="l.capacityofContactPerson.errors.required">This field is required.</div>
                            </div>
                        </div>
                        <div class="ui-g-4 ui-md-4">
                            <label for="contactNumber">Contact Number</label>
                            <input formControlName="contactNumber" autocomplete="off" type="text" pInputText
                                class="ui-inputtext ui-widget">
                            <div *ngIf="submitted && f.contactNumber.errors" class="text-error">
                                <br>
                                <div *ngIf="l.contactNumber.errors.required">This field is required.</div>
                            </div>
                        </div>
                        <div class="ui-g-4 ui-md-4">
                            <label for="escalation">Escalation %</label>
                            <input formControlName="escalation" autocomplete="off" type="number" pInputText
                                class="ui-inputtext ui-widget">
                            <div *ngIf="submitted && f.escalation.errors" class="text-error"><br>
                                <div *ngIf="l.escalation.errors.required">This field is required.</div>
                            </div>
                        </div>
                    </div>
                    <div class="ui-g-12 ui-md-12">
                        <div class="ui-g-4 ui-md-4">
                            <label for="occupationDate">Occupation Date</label>
                            <p-calendar formControlName="occupationDate" dateFormat="dd/mm/yy" showOtherMonths="true"
                                showButtonBar="true"></p-calendar>
                            <div *ngIf="submitted && f.occupationDate.errors" class="text-error">
                                <br>
                                <div *ngIf="l.occupationDate.errors.required">This field is required.</div>
                            </div>
                        </div>
                        <div class="ui-g-4 ui-md-4">
                            <label for="startingDate">Starting Date</label>
                            <p-calendar formControlName="startingDate" dateFormat="dd/mm/yy" showOtherMonths="true"
                                showButtonBar="true"></p-calendar>
                            <div *ngIf="submitted && f.startingDate.errors" class="text-error"><br>
                                <div *ngIf="l.startingDate.errors.required">This field is required.</div>
                            </div>
                        </div>
                        <div class="ui-g-4 ui-md-4">
                            <label for="terminationDate">Termination Date</label>
                            <p-calendar formControlName="terminationDate" dateFormat="dd/mm/yy" showOtherMonths="true"
                                showButtonBar="true"></p-calendar>
                            <div *ngIf="submitted && f.terminationDate.errors" class="text-error">
                                <br>
                                <div *ngIf="l.terminationDate.errors.required">This field is required.</div>
                            </div>
                        </div>
                    </div>
                    <div class="ui-g-12 ui-md-12">
                        <div class="ui-g-4 ui-md-4">
                            <label for="rentalAmount">Rental Amount</label>
                            <input formControlName="rentalAmount" autocomplete="off" type="number" pInputText
                               class="ui-inputtext ui-widget">
                            <div *ngIf="submitted && f.rentalAmount.errors" class="text-error"><br>
                                <div *ngIf="l.rentalAmount.errors.required">This field is required.</div>
                            </div>
                        </div>
                        <div class="ui-g-4 ui-md-4">
                            <label for="otherCharges">Other charges</label>
                            <input formControlName="otherCharges" autocomplete="off" type="number" pInputText
                               class="ui-inputtext ui-widget">
                            <div *ngIf="submitted && f.otherCharges.errors" class="text-error"><br>
                                <div *ngIf="l.otherCharges.errors.required">This field is required.</div>
                            </div>
                        </div>
                        <div class="ui-g-4 ui-md-4">
                            <label for="leaseNumber">Lease Number</label>
                            <input formControlName="leaseNumber" autocomplete="off" type="number" pInputText
                                class="ui-inputtext ui-widget">
                            <div *ngIf="submitted && f.leaseNumber.errors" class="text-error"><br>
                                <div *ngIf="l.leaseNumber.errors.required">This field is required.</div>
                            </div>
                        </div>
                    </div>
                    <div class="ui-g-12 ui-md-12">
                        <div class="ui-g-4 ui-md-4">
                            <label for="vat">Vat Number</label>
                            <p-dropdown inputId="vat" [options]="vats" formControlName="vat" (onChange)="setVat($event)"
                            placeholder="Please select" optionLabel="name"></p-dropdown>
                            <div *ngIf="submitted && f.vat.errors" class="text-error"><br>
                                <div *ngIf="l.vat.errors.required">This field is required.</div>
                            </div>
                        </div>
                    </div>
                </p-fieldset>
            </div>
            <p-footer>
                <button style="float: left; margin-top: 15px;" type="button" pButton icon="pi pi-times"
                    (click)="showDialog=false" label="Cancel" class="ui-button-secondary"></button>
                <button style="float: right; margin-top: 15px" type="submit" (click)="activeIndex = 1" pButton
                    icon="pi pi-angle-right" label="Next"></button>
                <button style="float: right; margin-top: 15px;margin-right: 10px" type="submit" pButton
                    icon="pi pi-check" label="Save"></button>
            </p-footer>
        </form>
    </p-tabPanel>
    <p-tabPanel header="Finance">
        <form [formGroup]="financialForm" *ngIf="!loading" (ngSubmit)="onFinancialFormSubmit()">
            <div class="ui-g ui-fluid" style="overflow-y: auto; overflow-x: hidden; height: 500px;width: 100%">
                <div class="ui-g-12 ui-md-12">
                    <p-fileUpload #fFiles [showUploadButton]="false" [showCancelButton]="false" (onRemove)="onFinanceRemoveFile($event)"  (onSelect)="onFinanceSelectFile($event.files)" name="myfile[]" url="./upload.php" multiple="multiple"></p-fileUpload>
                    <div>
                        <ul *ngFor="let file of financeFiles; let i = index" style="list-style-type:none;">
                            <li>
                                <p><a target="_blank" href="{{ file.url }}">{{ file.name }}</a></p>
                            </li>
                        </ul>                        
                    </div>   
                </div>
                <p-fieldset legend="General" [toggleable]="true">
                    <div class="ui-g-12 ui-md-12">
                        <div class="ui-g-6 ui-md-6">
                            <label for="landUseClass">Land Use Class</label>
                            <input formControlName="landUseClass" autocomplete="off" type="text" pInputText
                                class="ui-inputtext ui-widget">
                            <div *ngIf="submitted && f.landUseClass.errors" class="text-error"><br>
                                <div *ngIf="f.landUseClass.errors.required">This field is required.</div>
                            </div>
                        </div>
                        <div class="ui-g-6 ui-md-6">
                            <label for="class">Nature of Asset</label>
                            <input formControlName="natureofAsset" autocomplete="off" type="text" pInputText
                                class="ui-inputtext ui-widget">
                            <div *ngIf="submitted && f.natureofAsset.errors" class="text-error"><br>
                                <div *ngIf="f.natureofAsset.errors.required">This field is required.</div>
                            </div>
                        </div>

                    </div>
                </p-fieldset>

                <p-fieldset legend="Secondary Information Note" [toggleable]="true">
                    <div class="ui-g-12 ui-md-12">
                        <div class="ui-g-4 ui-md-4">
                            <label for="additionCash">Additions Cash</label>
                            <input formControlName="additionCash" autocomplete="off" type="number" pInputText
                                class="ui-inputtext ui-widget">
                            <div *ngIf="submitted && f.additionCash.errors" class="text-error"><br>
                                <div *ngIf="f.additionCash.errors.required">This field is required.</div>
                            </div>
                        </div>
                        <div class="ui-g-4 ui-md-4">
                            <label for="additionNonCash">Additions Non Cash</label>
                            <input formControlName="additionNonCash" autocomplete="off" type="number" pInputText
                                class="ui-inputtext ui-widget">
                            <div *ngIf="submitted && f.additionNonCash.errors" class="text-error"><br>
                                <div *ngIf="f.additionNonCash.errors.required">This field is required.</div>
                            </div>
                        </div>
                        <div class="ui-g-4 ui-md-4">
                            <label for="class">Additions</label>
                            <input formControlName="addition" autocomplete="off" type="number" pInputText
                                class="ui-inputtext ui-widget">
                            <div *ngIf="submitted && f.addition.errors" class="text-error"><br>
                                <div *ngIf="f.addition.errors.required">This field is required.</div>
                            </div>
                        </div>
                    </div>
                    <div class="ui-g-12 ui-md-12">
                        <div class="ui-g-6 ui-md-4">
                            <label for="disposal">Disposal</label>
                            <input formControlName="disposal" autocomplete="off" type="number" pInputText
                                class="ui-inputtext ui-widget">
                            <div *ngIf="submitted && f.disposal.errors" class="text-error"><br>
                                <div *ngIf="f.disposal.errors.required">This field is required.</div>
                            </div>
                        </div>
                        <div class="ui-g-6 ui-md-4">
                            <label for="closingBalance">Closing Balance</label>
                            <input formControlName="closingBalance" autocomplete="off" type="number" pInputText
                                class="ui-inputtext ui-widget">
                            <div *ngIf="submitted && f.closingBalance.errors" class="text-error"><br>
                                <div *ngIf="f.closingBalance.errors.required">This field is required.</div>
                            </div>
                        </div>
                        <div class="ui-g-6 ui-md-4"></div>
                    </div>
                </p-fieldset>

                <p-fieldset legend="Valuations" [toggleable]="true">
                    <div class="ui-g-12 ui-md-12">
                        <div class="ui-g-4 ui-md-4">
                            <label for="municipalValuation">Municipal Valuations</label>
                            <input formControlName="municipalValuation" autocomplete="off" type="text" pInputText
                                class="ui-inputtext ui-widget">
                            <div *ngIf="submitted && f.municipalValuation.errors" class="text-error"><br>
                                <div *ngIf="f.municipalValuation.errors.required">This field is required.</div>
                            </div>
                        </div>
                        <div class="ui-g-4 ui-md-4">
                            <label for="municipalValuationDate">Date of Municipal Valuation</label>
                            <p-calendar formControlName="municipalValuationDate" dateFormat="dd/mm/yy"
                                showOtherMonths="true" showButtonBar="true"></p-calendar>
                            <div *ngIf="submitted && f.municipalValuationDate.errors" class="text-error"><br>
                                <div *ngIf="f.municipalValuationDate.errors.required">This field is required.</div>
                            </div>
                        </div>
                        <div class="ui-g-4 ui-md-4">
                            <label for="class">Non Municipal Valuation</label>
                            <input formControlName="nonMunicipalValuation" autocomplete="off" type="text" pInputText
                                class="ui-inputtext ui-widget">
                            <div *ngIf="submitted && f.nonMunicipalValuation.errors" class="text-error"><br>
                                <div *ngIf="f.nonMunicipalValuation.errors.required">This field is required.</div>
                            </div>
                        </div>
                    </div>
                    <div class="ui-g-12 ui-md-12">
                        <div class="ui-g-4 ui-md-4">
                            <label for="type">Value</label>
                            <input formControlName="value" autocomplete="off" type="text" pInputText
                                 class="ui-inputtext ui-widget">
                            <div *ngIf="submitted && f.value.errors" class="text-error"><br>
                                <div *ngIf="f.value.errors.required">This field is required.</div>
                            </div>
                        </div>
                        <div class="ui-g-4 ui-md-4">
                            <label for="nonMunicipalValuationDate">Date of Non Municipal Valuation</label>
                            <p-calendar formControlName="nonMunicipalValuationDate" dateFormat="dd/mm/yy"
                                showOtherMonths="true" showButtonBar="true"></p-calendar>
                            <div *ngIf="submitted && f.nonMunicipalValuationDate.errors" class="text-error"><br>
                                <div *ngIf="f.nonMunicipalValuationDate.errors.required">This field is required.</div>
                            </div>
                        </div>
                        <div class="ui-g-4 ui-md-4">
                            <label for="propetyRatesAccount">Property Rates Account No</label>
                            <input formControlName="propetyRatesAccount" autocomplete="off" type="text" pInputText
                                class="ui-inputtext ui-widget">
                            <div *ngIf="submitted && f.propetyRatesAccount.errors" class="text-error"><br>
                                <div *ngIf="f.propetyRatesAccount.errors.required">This field is required.</div>
                            </div>
                        </div>
                    </div>
                    <div class="ui-g-12 ui-md-12">
                        <div class="ui-g-6 ui-md-4">
                            <label for="accountNoForService">Account no for Services</label>
                            <input formControlName="accountNoForService" autocomplete="off" type="text" pInputText
                               class="ui-inputtext ui-widget"
                                [ngClass]="{ 'is-invalid': submitted && f.name.errors }">
                            <div *ngIf="submitted && f.accountNoForService.errors" class="text-error"><br>
                                <div *ngIf="f.accountNoForService.errors.required">This field is required.</div>
                            </div>
                        </div>
                        <div class="ui-g-6 ui-md-4">
                            <label for="personInstitutionResposible">Person/Institution responsible for account</label>
                            <input formControlName="personInstitutionResposible" autocomplete="off" type="text"
                                pInputText class="ui-inputtext ui-widget" [ngClass]="{ 'is-invalid': submitted && f.name.errors }">
                            <div *ngIf="submitted && f.personInstitutionResposible.errors" class="text-error"><br>
                                <div *ngIf="f.personInstitutionResposible.errors.required">This field is required.</div>
                            </div>
                        </div>
                        <div class="ui-g-6 ui-md-4"></div>
                    </div>
                </p-fieldset>
            </div>
            <p-footer>
                <button style="float: left; margin-top: 15px;" type="button" pButton icon="pi pi-angle-left"
                    (click)="activeIndex = 0" label="Back" class="ui-button-secondary"></button>
                <button style="float: right; margin-top: 15px" type="submit" pButton icon="pi pi-angle-right"
                    label="Next" (click)="activeIndex = 2"></button>
                <button style="float: right; margin-top: 15px;margin-right: 10px" type="submit" pButton
                    icon="pi pi-check" label="Save"></button>
            </p-footer>
        </form>
    </p-tabPanel>
    <p-tabPanel header="Improvement">
        <form [formGroup]="improvementForm" *ngIf="!loading" (ngSubmit)="onImprovementFormSubmit()">
            <div class="ui-g ui-fluid">
                <div class="ui-g-12 ui-md-12">
                    <p-fileUpload #iFiles [showUploadButton]="false" [showCancelButton]="false" (onRemove)="onImprovementRemoveFile($event)" (onSelect)="onImprovementSelectFile($event.files)" name="myfile[]" multiple="multiple" (uploadHandler)="upload($event)"></p-fileUpload>
                    <div>
                        <ul *ngFor="let file of improvementFiles; let i = index" style="list-style-type:none;">
                            <li>
                                <p><a target="_blank" href="{{ file.url }}">{{ file.name }}</a></p>
                            </li>
                        </ul>                        
                    </div>  
                </div>
                <p-fieldset legend="General" [toggleable]="true">
                    <div class="ui-g-12 ui-md-12">
                        <div class="ui-g-3 ui-md-3">
                            <label for="deedsOffice">Building Name</label>
                            <input formControlName="buildingName" autocomplete="off" type="text" pInputText
                                class="ui-inputtext ui-widget"
                                [ngClass]="{ 'is-invalid': submitted && I.name.errors }">
                            <div *ngIf="submitted && I.buildingName.errors" class="text-error"><br>
                                <div *ngIf="I.buildingName.errors.required">This field is required.</div>
                            </div>
                        </div>
                        <div class="ui-g-3 ui-md-3">
                            <label for="class">Type</label>
                            <p-dropdown inputId="type" [options]="typeOfImprovements" formControlName="type"
                                (onChange)="setClass($event)" optionLabel="name"
                                placeholder="Please select" >
                            </p-dropdown>
                            <div *ngIf="submitted && I.type.errors" class="text-error"><br>
                                <div *ngIf="I.type.errors.required">This field is required.</div>
                            </div>
                        </div>
                        <div class="ui-g-3 ui-md-3">
                            <label for="type">Size (m2)</label>
                            <input formControlName="size" autocomplete="off" type="number" pInputText
                                class="ui-inputtext ui-widget" [ngClass]="{ 'is-invalid': submitted && f.name.errors }">
                            <div *ngIf="submitted && I.size.errors" class="text-error"><br>
                                <div *ngIf="I.size.errors.required">This field is required.</div>
                            </div>
                        </div>
                        <div class="ui-g-3 ui-md-3">
                            <label for="class">Potential Use</label>
                            <p-dropdown inputId="potentialUse" [options]="potentialUseList"
                            placeholder="Please select" formControlName="potentialUse" (onChange)="setClass($event)" optionLabel="name">
                            </p-dropdown>
                            <div *ngIf="submitted && I.potentialUse.errors" class="text-error"><br>
                                <div *ngIf="I.potentialUse.errors.required">This field is required.</div>
                            </div>
                        </div>
                    </div>

                    <div class="ui-g-12 ui-md-12">
                        <div class="ui-g-3 ui-md-3">
                            <label for="siteCoverag">Site Coverage %</label>
                            <input formControlName="siteCoverag" autocomplete="off" type="number" pInputText
                                class="ui-inputtext ui-widget"
                                [ngClass]="{ 'is-invalid': submitted && f.name.errors }">
                            <div *ngIf="submitted && I.siteCoverag.errors" class="text-error"><br>
                                <div *ngIf="I.siteCoverag.errors.required">This field is required.</div>
                            </div>
                        </div>
                        <div class="ui-g-3 ui-md-3">
                            <label for="levelofUtilization">Level of Utilization %</label>
                            <input formControlName="levelofUtilization" autocomplete="off" type="number" pInputText
                                class="ui-inputtext ui-widget"
                                [ngClass]="{ 'is-invalid': submitted && f.name.errors }">
                            <div *ngIf="submitted && I.levelofUtilization.errors" class="text-error"><br>
                                <div *ngIf="I.levelofUtilization.errors.required">This field is required.</div>
                            </div>
                        </div>
                        <div class="ui-g-3 ui-md-3">
                            <label for="extentofBuilding">Extent of Building (m2)</label>
                            <input formControlName="extentofBuilding" autocomplete="off" type="number" pInputText
                                class="ui-inputtext ui-widget"
                                [ngClass]="{ 'is-invalid': submitted && f.name.errors }">
                            <div *ngIf="submitted && I.extentofBuilding.errors" class="text-error"><br>
                                <div *ngIf="I.extentofBuilding.errors.required">This field is required.</div>
                            </div>
                        </div>
                        <div class="ui-g-3 ui-md-3">
                            <label for="class">Condition Rating</label>
                            <p-dropdown inputId="conditionRating" [options]="conditionRatings"
                                formControlName="conditionRating" (onChange)="setConditionRating($event)"
                                placeholder="Please select" optionLabel="name">
                            </p-dropdown>
                            <div *ngIf="submitted && I.conditionRating.errors" class="text-error"><br>
                                <div *ngIf="I.conditionRating.errors.required">This field is required.</div>
                            </div>
                        </div>
                    </div>
                    <div class="ui-g-12 ui-md-12">
                        <div class="ui-g-3 ui-md-3">
                            <label for="type">Usable area(m2)</label>
                            <input formControlName="usableArea" autocomplete="off" type="number" pInputText
                               class="ui-inputtext ui-widget"
                                [ngClass]="{ 'is-invalid': submitted && f.name.errors }">
                            <div *ngIf="submitted && I.usableArea.errors" class="text-error"><br>
                                <div *ngIf="I.usableArea.errors.required">This field is required.</div>
                            </div>
                        </div>
                        <div class="ui-g-3 ui-md-3">
                            <label for="class">Functional Performance Rating</label>
                            <p-dropdown inputId="functionalPerformanceRating" [options]="functionalPerformanceRatings"
                                formControlName="functionalPerformanceRating" (onChange)="setClass($event)"
                                placeholder="Please select" optionLabel="name">
                            </p-dropdown>
                            <div *ngIf="submitted && I.functionalPerformanceRating.errors" class="text-error"><br>
                                <div *ngIf="I.functionalPerformanceRating.errors.required">This field is required.</div>
                            </div>
                        </div>
                        <div class="ui-g-3 ui-md-3">
                            <label for="type">Comments</label>
                            <input formControlName="comment" autocomplete="off" type="text" pInputText
                                class="ui-inputtext ui-widget"
                                [ngClass]="{ 'is-invalid': submitted && f.name.errors }">
                            <div *ngIf="submitted && I.comment.errors" class="text-error"><br>
                                <div *ngIf="I.comment.errors.required">This field is required.</div>
                            </div>
                        </div>
                        <div class="ui-g-3 ui-md-3" style="float: right;">
                            <button (click)="AddImprovement()" pButton pRipple type="button" icon="pi pi-plus" class="p-button-rounded">Add</button>
                        </div>                        
                    </div>
                    <div class="ui-g-12 ui-md-12">
                        <p-table #dt [columns]="improvementCols" [paginator]="true" [rows]="5" selectionMode="single"
                            rowExpandMode="single"  [value]="improvements" dataKey="id" editMode="row"
                            styleClass="p-datatable-striped">
                            <ng-template pTemplate="caption">
                                <div style="text-align: right">
                                    <i class="pi pi-search" style="margin:4px 4px 0 0"></i>
                                    <input type="text" pInputText size="50" placeholder="Global Filter"
                                        class="ui-inputtext ui-widget"
                                        (input)="dt.filterGlobal($event.target.value, 'contains')" style="width:auto">
                                </div>
                            </ng-template>
                            <ng-template pTemplate="header">
                                <tr>
                                    <th *ngFor="let col of improvementCols">
                                        {{col.header}}
                                        <p-sortIcon [field]="col.field" ariaLabel="Activate to sort"
                                            ariaLabelDesc="Activate to sort in descending order"
                                            ariaLabelAsc="Activate to sort in ascending order"></p-sortIcon>
                                    </th>
                                    <th style="width:10em">Actions</th>
                                </tr>
                            </ng-template>
                            <ng-template pTemplate="body" let-rowData let-editing="editing" let-ri="rowIndex">
                                <tr [pEditableRow]="rowData">
                                    <td *ngFor="let col of improvementCols">
                                        {{rowData[col.field]}}
                                    </td>
                                    <td style="text-align: center;">
                                        <p-splitButton label="More" [model]="buttonItems"
                                            (onDropdownClick)="selectImprovement(rowData)" styleClass="p-button-secondary">
                                        </p-splitButton>
                                    </td>
                                </tr>

                            </ng-template>
                        </p-table>
                    </div>
                </p-fieldset>
            </div>

            <p-footer>
                <div style="text-align: center;" *ngIf="errorMsg != ''">

                </div>
                <div>
                    <button style="float: left; margin-top: 15px;" type="button" pButton icon="pi pi-angle-left"
                    (click)="activeIndex = 1" label="Back" class="ui-button-secondary"></button>
                <button style="float: right; margin-top: 15px" type="button" (click)="onSubmit()" pButton
                    icon="pi pi-angle-right" label="Submit" (click)="activeIndex = 2"></button>
                <button style="float: right; margin-top: 15px;margin-right: 10px" type="submit" pButton
                    icon="pi pi-check" label="Save"></button>
                </div>
               
            </p-footer>
        </form>
    </p-tabPanel>
</p-tabView>