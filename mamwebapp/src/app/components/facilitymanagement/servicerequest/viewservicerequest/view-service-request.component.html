<p-toast [style]="{marginTop: '80px'}" position="top-right"></p-toast>

<div class="text-center" style="color: red;" *ngIf="error">
    <h5 class="mt-20">
        <li class="pi pi-exclamation-triangle" style="color: red;font-size: xx-large;"></li><span> An error has
            occured...</span>
    </h5>
    <h6 class="color-aqua">{{errorMsg}}</h6>
</div>
<div>
    <div class="p-fluid p-grid p-formgrid">
        <div class="formgrid grid">
            <div class="field grid col-8">
                <span class="p-input-icon-left p-1">
                    <h5>Date Logged: {{selectedServiceRequest.createdDate | date:'d MMMM yyyy'}}</h5>                    
                </span>
            </div>
            <div class="field grid col-4">
                <span class="p-input-icon-left p-1" *ngIf="showSupplier">
                    <label for="float-input">Supplier</label>
                    <p-dropdown class="ui-inputtext ui-widget" [disabled]="isViewOnly" [style]="{'width':'470px'}"
                        inputId="supplier" [options]="suppliers" placeholder="Please Select" [(ngModel)]="supplier"
                        (onChange)="onSupplierChange($event);" optionLabel="name">
                    </p-dropdown>
                    <div *ngIf="submitted && f.supplier.errors" class="text-error"><br>
                        <div *ngIf="s.supplier.errors.required">This field is required.</div>
                    </div>
                </span>
            </div>
        </div>
        <div class="formgrid grid">
            <div class="field grid col-8">
                <span class="p-input-icon-left p-1">
                    <label for="float-input">Facility Name</label>
                    <div class="ui-inputtext ui-widget no-border">
                        {{selectedServiceRequest.facilityName}}
                    </div>
                </span>
            </div>
            <div class="field grid col-4">
                <span class="p-input-icon-left p-1" *ngIf="showProject">
                    <label for="float-input">Project</label>
                    <p-dropdown class="ui-inputtext ui-widget" [disabled]="isViewOnly" [style]="{'width':'470px'}"
                        inputId="project" [options]="projects" placeholder="Please Select" [(ngModel)]="project"
                        (onChange)="onProjectChange($event);" optionLabel="name">
                    </p-dropdown>
                    <div *ngIf="submitted && f.supplier.errors" class="text-error"><br>
                        <div *ngIf="s.supplier.errors.required">This field is required.</div>
                    </div>      
                </span>
            </div>
        </div>
        <div class="formgrid grid">
            <div class="field grid col-4">
                <span class="p-input-icon-left p-1">
                    <label for="float-input">Property Description</label>
                    <div class="ui-inputtext ui-widget no-border">
                        {{selectedServiceRequest.propertyDescription}}
                    </div>
                </span>
            </div>
            <div class="field grid col-4">
                <span class="p-input-icon-left p-1">
                    <label for="float-input">Name & Surname</label>
                    <div class="ui-inputtext ui-widget no-border">
                        {{selectedServiceRequest.contactName}}
                    </div>
                </span>
            </div>
            <div class="field grid col-4">
                
            </div>
        </div>
        <div class="formgrid grid">
            <div class="field grid col-4"></div>
            <div class="field grid col-4">
                <span class="p-input-icon-left p-1">
                    <label for="float-input">Contact Number</label>
                    <div class="ui-inputtext ui-widget no-border">
                        {{selectedServiceRequest.contactNumber}}
                    </div>
                </span>
            </div>
            <div class="field grid col-4"></div>
        </div>

        <div class="formgrid grid">
            <div class="field grid col-4">
                <span class="p-input-icon-left p-1">
                    <label for="float-input">Description of the issue</label>
                    <div class="ui-inputtext ui-widget no-border">
                        {{selectedServiceRequest.incidentDescription}}
                    </div>
                </span>
            </div>
            <div class="field grid col-4">
                <span class="p-input-icon-left p-1">
                    <label for="float-input">Attachments</label>
                    <div class="ui-inputtext ui-widget no-border">                      
                            <ul style="list-style: none; margin-top: auto;padding-left: 1px;">
                                <li *ngFor="let file of attachments; let i = index">
                                    <p><a target="_blank" href="{{ file.url }}">{{ file.name }}</a></p>
                                </li>
                                <br/>
                            </ul>
                    </div>
                </span>
            </div>
            <div class="field grid col-4" style="border: darkgray solid 1px;">
                <span class="p-input-icon-left p-1">
                    <label for="float-input">Completion certificate</label>
                    <div class="ui-inputtext ui-widget no-border">
                        <ul style="list-style: none; width: 100%; padding-left: 10px;margin-top: auto;">
                            <li style="height: 25px;">
                                <div class="formgrid grid">
                                    <div class="field grid col-10">
                                        <span>Completion certificate </span>
                                    </div>
                                    <div class="field grid col-2">
                                        <p-checkbox 
                                        [binary]="true"
                                        inputId="checkbox1"
                                        [(ngModel)]="selectedServiceRequest.hasCompletionCertificate" 
                                        (onChange)="onCompletionCertificateChange($event)"
                                        (value)="ticketHasCompletionCertificate"></p-checkbox>
                                    </div>
                                </div>
                            </li>
                            <li style="height: 25px;">
                                <div class="formgrid grid">
                                    <div class="field grid col-10">
                                        <span>Contract invoice</span>.
                                    </div>
                                    <div class="field grid col-2">
                                        <p-checkbox [binary]="true"
                                        inputId="checkbox1"
                                        [(ngModel)]="selectedServiceRequest.hasContractInvoice"  (onChange)="onContractInvoiceChange($event)"
                                            [value]="ticketHasContractInvoice"></p-checkbox>
                                    </div>
                                </div>
                            </li>
                        </ul>
                    </div>
                </span>
            </div>
        </div>
        <div class="formgrid grid">
                <div class="field grid col-8">
                    <span class="p-input-icon-left p-1">
                        <label for="float-input">Notes</label>
                        <div class="ui-inputtext ui-widget no-border">
                            <textarea style="border: gray solid 1px;" [rows]="4" autoResize="false" [cols]="90" pInputTextarea [(ngModel)]="selectedServiceRequest.notes"></textarea>
                        </div>
                    </span>
                </div>  
                <div class="field grid col-2"></div>
                <div class="field grid col-2">
                    <button *ngIf="isUpdated" class="p-button-secondary" style="right: 180px;width: fit-content;bottom: 35px;position: absolute;
                    height: fit-content;" type="button" (click)="onCancel();" pButton label="Close"></button>  
                    <button *ngIf="!canCloseTicket && selectedServiceRequest.status != 'Close'" style="right: 35px;width: fit-content;bottom: 35px;position: absolute;
                    height: fit-content;" type="button"
                    (click)="onSubmit(); activeIndex = 2" pButton label="Submit"></button>   
                    <button *ngIf="canCloseTicket && selectedServiceRequest.status != 'Close'" style="right: 35px;
                    bottom: 35px;position: absolute;
                    width: fit-content;
                    height: fit-content;" type="button"
                    (click)="onCloseicket(); activeIndex = 2" pButton label="Close This Ticket"></button>  
                </div>   
        </div>
    </div>