<p-toast [style]="{marginTop: '90px'}" position="top-right"></p-toast>
<div class="header">
    <header>
        STRATEGIC NEEDS ASSESSMENT: CURRENT UTILISATION/NEEDS ASSESSMENT OF ACCOMMODATION OCCUPIED
    </header>
</div>
<br>
<br>
<div class="ui-g ui-fluid">
    <form [formGroup]="assessmentStrategicForm">
        <div class="formgrid grid">
            <div class="field col-6">
                <small for="district">District</small>
                <input (keydown)="onBlurDistrict()" formControlName="district" autocomplete="off" type="text" pInputText
                    class="ui-inputtext ui-widget w-full">
            </div>
        </div>

        <p-fieldset legend="Add post" [hidden]="!showFields" [toggleable]="true">
     
        <div class="formgrid grid pt-5"> 
            <div class="field col-6" >
                <span class="p-float-label p-input-icon-left w-full">
                    <input formControlName="postDescriptionTitle" autocomplete="off" type="text" pInputText
                        class="ui-inputtext ui-widget w-full pr-3" >
                    <label for="float-input">Post Description/ Title</label>
                </span>
            </div>

            <div class="field col-6" style="margin-top: -35px;">
                <label for="allocatedSpace" class="col-fixed">Allocated Space</label>
                <p-inputNumber class="ui-inputtext ui-widget" formControlName="allocatedSpace"></p-inputNumber>  
               <small>As per usable office space</small>
            </div>
            
        </div>

        <div class="formgrid grid"> 
            <div class="col-6 pr-5" >
                <span class="mb-5">Requirements in Terms of filled & budgeted Posts</span>
                <br>
                <div class="formgrid grid">
                <div class="field col-4">
                    <label for="fbpLevel" class="col-fixed">Level</label>
                    <p-inputNumber formControlName="fbpLevel" class="ui-inputtext ui-widget"></p-inputNumber>                        
                </div>
                <div class="field col-4">
                    <label for="fbpQuantity" class="col-fixed">Quantity</label>
                        <p-inputNumber class="ui-inputtext ui-widget" formControlName="fbpQuantity"></p-inputNumber>                        
                </div>
                <div class="field col-4">
                    <label for="fbpNorm"  class="col-fixed">Norm</label>
                        <p-inputNumber class="ui-inputtext ui-widget" formControlName="fbpNorm"></p-inputNumber>                        
                </div>
            </div>
            </div>
            <div class="col-6">
                <span>Requirements in Terms of Approved Organogram</span><br>
                <div class="formgrid grid">
                <div class="field col-4">
                    <label for="aoLevel" class="col-fixed">Level</label>
                    <p-inputNumber class="ui-inputtext ui-widget" formControlName="aoLevel"></p-inputNumber> 
                </div>

                <div class="field col-4">
                        <label for="float-input" class="col-fixed w-4">Quantity</label>
                        <p-inputNumber class="ui-inputtext ui-widget" formControlName="aoQuantity"></p-inputNumber>   
                </div>

                <div class="field col-4">
                        <label for="float-input" class="col-fixed w-4">Norm</label>
                        <p-inputNumber class="ui-inputtext ui-widget" formControlName="aoNorm"></p-inputNumber>       
                </div>
            </div>
            </div> 
        </div>
        
            <div class="col-12">
                <button *ngIf="!isEdit" pButton type="button" icon="pi pi-plus" label="Add Strategic Assessment"
                    (click)="addStrategicNeedsAssessment()" style="width: fit-content;float: right;"></button>
                <button pButton *ngIf="isEdit" type="button" icon="pi pi-pencil" label="Update Strategic Assessment"
                    (click)="onUpdate()" style="width: fit-content; float: right;"></button>
            </div>
    </p-fieldset>
    </form>

    <div class="ui-g ui-fluid">

        <p-table [value]="strategicAssessments" styleClass="p-datatable-striped" [responsive]="true">
            <ng-template pTemplate="header">
                <tr>
                    <th></th>
                    <th colspan="4" style="width: 25%;">Requirements in Terms of Approved Organogram</th>
                    <th colspan="4" style="width: 25%;">Requirements in Terms of filled & budgeted Posts</th>
                    <th></th>
                    <th colspan="2">Space Utilisation</th>
                    <th></th>
                </tr>
                <tr>
                    <th>Post Description/ Title</th>
                    <th>Level</th>
                    <th>Quantity</th>
                    <th>Norm</th>
                    <th>Requirement</th>
                    <th>Level</th>
                    <th>Quantity</th>
                    <th>Norm</th>
                    <th>Requirement</th>
                    <th>Allocated Space</th>
                    <th>Surplus (+) or Shortage (-) of Accommodation(mÂ²)</th>
                    <th>Percentage Utilised</th>
                    <th></th>
                </tr>
            </ng-template>
            <ng-template pTemplate="body" let-strategicAssessment let-rowIndex="rowIndex">
                <tr class="ui-widget-header" *ngIf="rowGroupMetadata[strategicAssessment.district].index === rowIndex">
                    <td colspan="13">
                        <span style="font-weight:bold">{{strategicAssessment.district}}</span>
                    </td>
                </tr>
                <tr>
                    <td>{{strategicAssessment.postDescriptionTitle}}</td>
                    <td>{{strategicAssessment.fbpLevel}}</td>
                    <td>{{strategicAssessment.fbpQuantity}}</td>
                    <td>{{strategicAssessment.fbpNorm}}</td>
                    <td>{{strategicAssessment.fbpRequirement}}</td>
                    <td>{{strategicAssessment.aoLevel}}</td>
                    <td>{{strategicAssessment.aoQuantity}}</td>
                    <td>{{strategicAssessment.aoNorm}}</td>
                    <td>{{strategicAssessment.aoRequirement}}</td>
                    <td>{{strategicAssessment.allocatedSpace}}</td>
                    <td>{{strategicAssessment.surplusShortageAccommodation}}</td>
                    <td [ngClass]="strategicAssessment.percentageUtilised < 0 ? 'red' : 'textColor'">
                        {{strategicAssessment.percentageUtilised | number : '1.2-2'}}%</td>
                    <td style="text-align: center;" *ngIf="strategicAssessments.length > 0">
                        <p-splitButton label="More" *ngIf="mode != 'View'" [model]="buttonItems"
                            (onDropdownClick)="selectStrategicNeedsAssessment(strategicAssessment)"
                            styleClass="p-button-secondary">
                        </p-splitButton>
                    </td>
                </tr>
            </ng-template>
        </p-table>
    </div>
</div>


<div *ngIf="showComfirmationDelete" class="dialogBackgroud"></div>
<p-dialog header="Confirmation" [(visible)]="showComfirmationDelete" [breakpoints]="{'960px': '75vw'}"
    [style]="{width: '25vw'}" [baseZIndex]="10000" [draggable]="false" [resizable]="false">
    <p>Are you sure that you want to delete this strategic assessment?</p>
    <p-footer>
        <button style="float: left;" (click)="showComfirmationDelete=false" pButton type="button" label="No"
            class="ui-button-info"></button>
        <button style="float: right;" (click)="showComfirmationDelete=false;deleteStrategicAssessment()" pButton
            type="button" label="Yes" class="ui-button-info"></button>
    </p-footer>
</p-dialog>